#N canvas 470 45 575 359 10;
#X obj 324 31 inlet A;
#X obj 386 31 inlet D;
#X obj 445 31 inlet S;
#X obj 505 31 inlet R;
#X obj 95 295 outlet~;
#X obj 254 62 s \$0-amp;
#X obj 386 63 s \$0-D;
#X obj 445 63 s \$0-S;
#X obj 505 63 s \$0-R;
#X obj 324 63 s \$0-A;
#X obj 254 31 inlet amp;
#N canvas 594 204 529 327 guts 0;
#X obj 19 49 sel 0;
#X obj 46 300 outlet~;
#X obj 46 221 line~;
#X obj 126 157 t b b;
#N canvas 768 174 364 514 compute 0;
#X obj 12 48 inlet~;
#X obj 37 192 snapshot~;
#X obj 37 327 + 0;
#X obj 37 242 t b f;
#X obj 37 481 s \$0-peak;
#X obj 37 146 spigot;
#X obj 94 113 spigot;
#X obj 173 82 r \$0-legato;
#X text 15 12 compute a new peak based on the current value + 1;
#X text 249 83 is legato mode on?;
#X obj 94 48 inlet compute;
#X obj 172 160 sel 0;
#X msg 172 188 0;
#X text 214 174 reset peak;
#X obj 37 298 f 1;
#X obj 141 219 r \$0-amp;
#X obj 239 283 / 127;
#X obj 37 354 * 1;
#X obj 212 221 r \$0-vel;
#X text 119 348 amplitude is multiplyed by the vel;
#X obj 212 258 t b f;
#X obj 141 248 t b f;
#X obj 198 123 r \$0-take-snapshot;
#X obj 37 379 t f f;
#X obj 37 456 spigot;
#X text 138 424 dont let peak get too large;
#X obj 91 432 sel 0;
#X obj 64 406 < 1;
#X msg 91 456 1;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 2 0 17 0;
#X connect 3 0 14 0;
#X connect 3 1 2 1;
#X connect 5 0 1 0;
#X connect 6 0 5 0;
#X connect 7 0 6 1;
#X connect 7 0 11 0;
#X connect 10 0 6 0;
#X connect 11 0 12 0;
#X connect 12 0 3 0;
#X connect 14 0 2 0;
#X connect 15 0 21 0;
#X connect 16 0 17 1;
#X connect 17 0 23 0;
#X connect 18 0 20 0;
#X connect 20 0 14 0;
#X connect 20 1 16 0;
#X connect 21 0 14 0;
#X connect 21 1 14 1;
#X connect 22 0 5 1;
#X connect 22 0 11 0;
#X connect 23 0 24 0;
#X connect 23 1 27 0;
#X connect 24 0 4 0;
#X connect 26 0 28 0;
#X connect 27 0 24 1;
#X connect 27 0 26 0;
#X connect 28 0 4 0;
#X restore 66 262 pd compute peak;
#N canvas 104 105 398 467 ADS 0;
#X obj 41 438 outlet;
#X obj 41 23 inlet trigger;
#X obj 263 377 pack 0 \$3;
#X obj 263 247 * 0.01;
#X obj 151 147 r \$0-A;
#X obj 314 347 r \$0-D;
#X obj 284 163 r \$0-S;
#X obj 118 188 del \$2;
#X obj 263 221 f \$4;
#X obj 284 190 clip 0 100;
#X obj 41 186 pack 1 \$2;
#X msg 118 96 stop;
#X obj 41 93 t b b;
#X obj 263 347 * 1;
#X obj 41 149 f 1;
#X obj 278 318 r \$0-peak;
#X obj 56 123 r \$0-peak;
#X obj 41 58 t b b;
#X text 90 57 stop current attack before triggering new one;
#X text 129 121 Attack;
#X text 219 349 Decay;
#X text 302 221 Sustain;
#X text 99 436 use the current peak level as a target for line~;
#X connect 1 0 17 0;
#X connect 2 0 0 0;
#X connect 3 0 13 0;
#X connect 4 0 7 1;
#X connect 4 0 10 1;
#X connect 5 0 2 1;
#X connect 6 0 9 0;
#X connect 7 0 8 0;
#X connect 8 0 3 0;
#X connect 9 0 8 1;
#X connect 10 0 0 0;
#X connect 11 0 7 0;
#X connect 12 0 14 0;
#X connect 12 1 7 0;
#X connect 13 0 2 0;
#X connect 14 0 10 0;
#X connect 15 0 13 1;
#X connect 16 0 14 1;
#X connect 17 0 12 0;
#X connect 17 1 11 0;
#X restore 46 127 pd ADS;
#X obj 46 89 t b b;
#N canvas 521 135 401 376 R 0;
#X obj 52 15 inlet trigger;
#X obj 157 16 inlet attack reset;
#X obj 52 118 pack 0 \$5;
#X obj 103 70 r \$0-R;
#X obj 128 119 del \$5;
#X obj 52 69 t b b;
#X msg 157 86 stop;
#X text 85 38 Release;
#X obj 32 351 outlet;
#X obj 90 174 s \$0-take-snapshot;
#X msg 128 150 0;
#X msg 90 150 1;
#X text 88 195 take a snapshot for the peak only during a release;
#X obj 79 236 r \$0-release;
#X obj 32 322 mux 1 2;
#X msg 116 290 1;
#X msg 79 288 0;
#X obj 79 262 sel 0;
#X text 140 260 send a decay if release mode is on;
#X msg 17 117 0 5;
#X connect 0 0 5 0;
#X connect 1 0 6 0;
#X connect 2 0 11 0;
#X connect 2 0 14 1;
#X connect 3 0 2 1;
#X connect 3 0 4 1;
#X connect 4 0 10 0;
#X connect 5 0 19 0;
#X connect 5 0 2 0;
#X connect 5 1 4 0;
#X connect 6 0 4 0;
#X connect 10 0 9 0;
#X connect 11 0 9 0;
#X connect 13 0 17 0;
#X connect 14 0 8 0;
#X connect 15 0 14 2;
#X connect 16 0 14 2;
#X connect 17 0 16 0;
#X connect 17 1 15 0;
#X connect 19 0 14 0;
#X restore 105 186 pd R;
#X obj 19 147 t b;
#X text 168 251 compute a new peak if in legato mode and the prev release
is active;
#X text 123 106 reset the prev attack and trigger the ADS on note on
(vel 1-127);
#X text 167 187 trigger the release on a note off (vel 0) \, if release
is on;
#X obj 19 15 inlet;
#X text 87 13 adapted from the pd example adsr patch;
#X connect 0 0 8 0;
#X connect 0 1 6 0;
#X connect 2 0 4 0;
#X connect 2 0 1 0;
#X connect 3 0 7 1;
#X connect 3 1 4 1;
#X connect 5 0 2 0;
#X connect 6 0 5 0;
#X connect 6 1 3 0;
#X connect 7 0 2 0;
#X connect 8 0 7 0;
#X connect 12 0 0 0;
#X restore 95 267 pd guts;
#X text 16 -31 ADSR ENVELOPE;
#X text 17 49 Creation args: amp \, A \, D \, S \, R;
#X text 338 300 danomatika.com | robotcowboy.com;
#X obj 64 81 inlet;
#X obj 68 170 t b b;
#X text 157 201 note duration;
#X obj 95 201 delay 100;
#X msg 95 238 0;
#X msg 44 238 1;
#X obj 188 168 s \$0-legato;
#X obj 64 114 route float bang dur legato release;
#X obj 229 145 s \$0-release;
#N canvas 0 22 211 162 defaults 0;
#X obj 43 50 loadbang;
#X msg 43 82 legato 0 \, release 1;
#X obj 43 116 outlet;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X restore 113 81 pd defaults;
#X text 266 172 onoff;
#X text 316 147 onoff;
#X text 17 -10 Level \, attack time \, decay time \, sustain level
\, release time. amp is 0-1 \; A \, D \, and R are in msec \; and S
is in percent.;
#X text 337 282 2007 Dan Wilcox \, updated 2009;
#N canvas 0 22 450 300 vel 0;
#X text 106 64 velocity;
#X obj 31 64 clip 0 127;
#X obj 31 91 sel 0;
#X obj 57 135 t b f;
#X obj 84 172 s \$0-vel;
#X obj 31 28 inlet;
#X obj 83 215 outlet off;
#X obj 18 215 outlet on;
#X connect 1 0 2 0;
#X connect 2 0 6 0;
#X connect 2 1 3 0;
#X connect 3 0 7 0;
#X connect 3 1 4 0;
#X connect 5 0 1 0;
#X restore 19 169 pd vel;
#X connect 0 0 9 0;
#X connect 1 0 6 0;
#X connect 2 0 7 0;
#X connect 3 0 8 0;
#X connect 10 0 5 0;
#X connect 11 0 4 0;
#X connect 15 0 22 0;
#X connect 16 0 20 0;
#X connect 16 1 18 0;
#X connect 18 0 19 0;
#X connect 19 0 11 0;
#X connect 20 0 11 0;
#X connect 22 0 29 0;
#X connect 22 1 16 0;
#X connect 22 2 18 1;
#X connect 22 3 21 0;
#X connect 22 4 23 0;
#X connect 24 0 22 0;
#X connect 29 0 20 0;
#X connect 29 1 19 0;
